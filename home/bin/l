#!/bin/bash

# Argument transposer

f() {
    local a=()
    local b=()
    local c=()
    for i in "$@"; do
        if [[ "$i" = -- ]]; then
            a+=("${b[@]}")
            b=()
        fi
        b+=("$i")
    done
    b=("${b[@]:1}")
    for i in "${a[@]}"; do
        if [[ "$i" = -- ]]; then
            c+=("${b[0]}")
            b=("${b[@]:1}")
        elif [[ "$i" = --- ]]; then
            c+=("${b[@]}")
            b=()
        else
            c+=("$i")
        fi
    done
    # echo "a: ${a[*]}"
    # echo "b: ${b[*]}"
    # echo "c: ${c[*]}"
    "${c[@]}"
}

# [[ "$(f echo a -- b -- c)"      == "a c b"   ]] || echo fail
# [[ "$(f echo a -- -- b -- c d)" == "a c d b" ]] || echo fail
# [[ "$(f echo a --- b -- c d)"   == "a c d b" ]] || echo fail

f "$@"
