#!/bin/sh

text=$*

if [ -n "${IS_WSL}${WSL_DISTRO_NAME}${WSL_INTEROP}${WSL_ENV}" ]; then # wsl
    cd / # might fail if pwd is network shared directory etc. so always cd to /
    # explicitly saving to a sjis file (\\wsl$\ cannot be read by cmd.exe)
    # how to make something like this work?: cmd.exe /c "echo ??? | clip.exe"
    tmp=xcopytmp.txt
    rm "/mnt/c/$tmp"
    { [ -z "$text" ] && cat || echo "$text"; } \
        > "/mnt/c/$tmp"
        # | iconv -t shift-jis > "/mnt/c/$tmp"
    cmd.exe /c "clip.exe < c:\\$tmp" >/dev/null 2>&1
    # < "$tmp3" sh -c "clip.exe" &
    # | iconv -f utf-8 -t shift-jis | sh -c "clip.exe" &
    # cat | sh -c "clip.exe" &
    # clip.exe < /dev/stdin & # not work from nvim
    # cat | clip.exe & # works, but sometimes slow
    # cat | sh -c "clip.exe" & # works and fast (why?)
    # Also, must give shift-jis text to clip.exe (otherwise garbage when pasting on windows)
    # { [ -z "$text" ] && cat || echo "$text"; } \
    #     | wsl_enc | sh -c "clip.exe" &

elif command -v xclip >/dev/null; then # xorg
    { [ -z "$text" ] && cat || echo "$text"; } \
        | xclip -selection clipboard -i

fi

