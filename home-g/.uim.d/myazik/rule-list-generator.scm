(define (main args)
  (when (< (length args) 3)
    (error "Usage : gosh rule-list-generator.scm infile outfile")
    )
  (let ((infile (cadr args))
        (outfile (caddr args))
        )
    (call-with-output-file outfile
      (lambda (op)
        (write (read-rulelist-from-file infile) op)
        ))
    ))

(define (read-rulelist-from-file infile)
  (call-with-input-file infile
    (lambda (ip)
      (let loop ((line (read-line ip))
                 (rules '()))
        (if (eof-object? line)
          (reverse rules)
          (loop (read-line ip)
                (cons (make-rule-sexp line) rules))
          )
        ))))

(define (make-rule-sexp line)
  (define (string->string-list str) (map string (string->list str)))
  (let* ((sp (string-split line " "))
         (in-seq (string->string-list (car sp)))
         (rem-seq '())
         (hira (cadr sp))
         (hira-sep (string->string-list hira))
         (kata-sep (let1 try (map hira->kata hira-sep)
                     (if (memv #f try) hira-sep try)))
         (kata (apply string-append kata-sep))
         (han-kata-sep (let1 try (map hira->han-kata hira-sep)
                         (if (memv #f try) hira-sep try)))
         (han-kata (apply string-append han-kata-sep))
         )
    ;; Difference between (("かい")) and (("か") ("い"))
    ;; Multiple chars (like かい) are deleted at once by a single Backspace.
    ; `((,in-seq . ,rem-seq) ((,hira ,kata ,han-kata)))
    ;; Multiple chars (like かい) are deleted char by char.
    ;; A single Backspace deletes only one char at once.
    `((,in-seq . ,rem-seq) (,(map list hira-sep kata-sep han-kata-sep)))
    ) )

(define (hira->kata kana) (trans-by-ja-rk car cadr kana))
(define (hira->han-kata kana) (trans-by-ja-rk car caddr kana))
(define (trans-by-ja-rk from-getter to-getter kana)
  (if-let1 try (find (lambda (r) (string=? (from-getter r) kana))
                     ja-rk-rule)
    (to-getter try)
    #f))
(define ja-rk-rule-basic
  '(
    ((("-"). ())("ー" "ー" "ｰ"))
    (((","). ())("、" "、" "､"))
    ((("."). ())("。" "。" "｡"))
    ((("!"). ())("！" "！" "!"))
    ((("\""). ())("”" "”" "\""))
    ((("#"). ())("＃" "＃" "#"))
    ((("$"). ())("＄" "＄" "$"))
    ((("%"). ())("％" "％" "%"))
    ((("&"). ())("＆" "＆" "&"))
    ((("'"). ())("’" "’" "'"))
    ((("("). ())("（" "（" "("))
    (((")"). ())("）" "）" ")"))
    ((("~"). ())("〜" "〜" "~"))
    ((("="). ())("＝" "＝" "="))
    ((("^"). ())("＾" "＾" "^"))
    ((("\\"). ())("＼" "＼" "\\"))
    ((("|"). ())("｜" "｜" "|"))
    ((("`"). ())("‘" "‘" "`"))
    ((("@"). ())("＠" "＠" "@"))
    ((("{"). ())("｛" "｛" "{"))
    ((("["). ())("「" "「" "｢"))
    ((("+"). ())("＋" "＋" "+"))
    (((";"). ())("；" "；" ";"))
    ((("*"). ())("＊" "＊" "*"))
    (((":"). ())("：" "：" ":"))
    ((("}"). ())("｝" "｝" "}"))
    ((("]"). ())("」" "」" "｣"))
    ((("<"). ())("＜" "＜" "<"))
    (((">"). ())("＞" "＞" ">"))
    ((("?"). ())("？" "？" "?"))
    ((("/"). ())("／" "／" "/"))
    ((("_"). ())("＿" "＿" "_"))
    ;; Since ordinary Japanese users press the "yen sign" key on
    ;; Japanese keyboard in romaji-halfwidth-kana-mode "to input
    ;; character code 134" rather than "to input yen sign symbol", I
    ;; changed the fullwidth yen sign with backslash.
    ;;   -- YamaKen 2007-09-17
    ;; ((("yen"). ())("￥" "￥" "￥")) ;; XXX
    ((("yen"). ())("￥" "￥" "\\"))

    ((("1"). ())("1" "1" "1"))
    ((("2"). ())("2" "2" "2"))
    ((("3"). ())("3" "3" "3"))
    ((("4"). ())("4" "4" "4"))
    ((("5"). ())("5" "5" "5"))
    ((("6"). ())("6" "6" "6"))
    ((("7"). ())("7" "7" "7"))
    ((("8"). ())("8" "8" "8"))
    ((("9"). ())("9" "9" "9"))
    ((("0"). ())("0" "0" "0"))

    ((("a"). ())("あ" "ア" "ｱ"))
    ((("i"). ())("い" "イ" "ｲ"))
    ((("u"). ())("う" "ウ" "ｳ"))
    ((("e"). ())("え" "エ" "ｴ"))
    ((("o"). ())("お" "オ" "ｵ"))

    ((("x" "a"). ())("ぁ" "ァ" "ｧ"))
    ((("x" "i"). ())("ぃ" "ィ" "ｨ"))
    ((("x" "y" "i"). ())("ぃ" "ィ" "ｨ"))
    ((("x" "u"). ())("ぅ" "ゥ" "ｩ"))
    ((("x" "e"). ())("ぇ" "ェ" "ｪ"))
    ((("x" "y" "e"). ())("ぇ" "ェ" "ｪ"))
    ((("x" "o"). ())("ぉ" "ォ" "ｫ"))

    ((("l" "a"). ())("ぁ" "ァ" "ｧ"))
    ((("l" "i"). ())("ぃ" "ィ" "ｨ"))
    ((("l" "u"). ())("ぅ" "ゥ" "ｩ"))
    ((("l" "e"). ())("ぇ" "ェ" "ｪ"))
    ((("l" "o"). ())("ぉ" "ォ" "ｫ"))

    ((("k" "k"). ("k"))("っ" "ッ" "ｯ"))

    ((("k" "a"). ())("か" "カ" "ｶ"))
    ((("k" "i"). ())("き" "キ" "ｷ"))
    ((("k" "u"). ())("く" "ク" "ｸ"))
    ((("k" "e"). ())("け" "ケ" "ｹ"))
    ((("k" "o"). ())("こ" "コ" "ｺ"))
    ((("k" "y" "a"). ())(("き" "キ" "ｷ") ("ゃ" "ャ" "ｬ")))
    ((("k" "y" "i"). ())(("き" "キ" "ｷ") ("ぃ" "ィ" "ｨ")))
    ((("k" "y" "u"). ())(("き" "キ" "ｷ") ("ゅ" "ュ" "ｭ")))
    ((("k" "y" "e"). ())(("き" "キ" "ｷ") ("ぇ" "ェ" "ｪ")))
    ((("k" "y" "o"). ())(("き" "キ" "ｷ") ("ょ" "ョ" "ｮ")))

    ((("g" "g"). ("g"))("っ" "ッ" "ｯ"))


    ((("g" "a"). ())("が" "ガ" "ｶﾞ"))
    ((("g" "i"). ())("ぎ" "ギ" "ｷﾞ"))
    ((("g" "u"). ())("ぐ" "グ" "ｸﾞ"))
    ((("g" "e"). ())("げ" "ゲ" "ｹﾞ"))
    ((("g" "o"). ())("ご" "ゴ" "ｺﾞ"))

    ((("g" "y" "a"). ())(("ぎ" "ギ" "ｷﾞ") ("ゃ" "ャ" "ｬ")))
    ((("g" "y" "i"). ())(("ぎ" "ギ" "ｷﾞ") ("ぃ" "ィ" "ｨ")))
    ((("g" "y" "u"). ())(("ぎ" "ギ" "ｷﾞ") ("ゅ" "ュ" "ｭ")))
    ((("g" "y" "e"). ())(("ぎ" "ギ" "ｷﾞ") ("ぇ" "ェ" "ｪ")))
    ((("g" "y" "o"). ())(("ぎ" "ギ" "ｷﾞ") ("ょ" "ョ" "ｮ")))

    ((("q" "a"). ())(("く" "ク" "ｸ") ("ぁ" "ァ" "ｧ")))
    ((("q" "i"). ())(("く" "ク" "ｸ") ("ぃ" "ィ" "ｨ")))
    ((("q" "u"). ())("く" "ク" "ｸ"))
    ((("q" "e"). ())(("く" "ク" "ｸ") ("ぇ" "ェ" "ｪ")))
    ((("q" "o"). ())(("く" "ク" "ｸ") ("ぉ" "ォ" "ｫ")))

    ((("s" "s"). ("s"))("っ" "ッ" "ｯ"))

    ((("s" "a"). ())("さ" "サ" "ｻ"))
    ((("s" "i"). ())("し" "シ" "ｼ"))
    ((("s" "u"). ())("す" "ス" "ｽ"))
    ((("s" "e"). ())("せ" "セ" "ｾ"))
    ((("s" "o"). ())("そ" "ソ" "ｿ"))

    ((("s" "y" "a"). ())(("し" "シ" "ｼ") ("ゃ" "ャ" "ｬ")))
    ((("s" "y" "i"). ())(("し" "シ" "ｼ") ("ぃ" "ィ" "ｨ")))
    ((("s" "y" "u"). ())(("し" "シ" "ｼ") ("ゅ" "ュ" "ｭ")))
    ((("s" "y" "e"). ())(("し" "シ" "ｼ") ("ぇ" "ェ" "ｪ")))
    ((("s" "y" "o"). ())(("し" "シ" "ｼ") ("ょ" "ョ" "ｮ")))

    ((("z" "z"). ("z"))("っ" "ッ" "ｯ"))

    ((("z" "a"). ())("ざ" "ザ" "ｻﾞ"))
    ((("z" "i"). ())("じ" "ジ" "ｼﾞ"))
    ((("z" "u"). ())("ず" "ズ" "ｽﾞ"))
    ((("z" "e"). ())("ぜ" "ゼ" "ｾﾞ"))
    ((("z" "o"). ())("ぞ" "ゾ" "ｿﾞ"))
    ((("z" "y" "a"). ())(("じ" "ジ" "ｼﾞ") ("ゃ" "ャ" "ｬ")))
    ((("z" "y" "i"). ())(("じ" "ジ" "ｼﾞ") ("ぃ" "ィ" "ｨ")))
    ((("z" "y" "u"). ())(("じ" "ジ" "ｼﾞ") ("ゅ" "ュ" "ｭ")))
    ((("z" "y" "e"). ())(("じ" "ジ" "ｼﾞ") ("ぇ" "ェ" "ｪ")))
    ((("z" "y" "o"). ())(("じ" "ジ" "ｼﾞ") ("ょ" "ョ" "ｮ")))

    ((("j" "j"). ("j"))("っ" "ッ" "ｯ"))

    ((("j" "a"). ())(("じ" "ジ" "ｼﾞ") ("ゃ" "ャ" "ｬ")))
    ((("j" "i"). ())("じ" "ジ" "ｼﾞ"))
    ((("j" "u"). ())(("じ" "ジ" "ｼﾞ") ("ゅ" "ュ" "ｭ")))
    ((("j" "e"). ())(("じ" "ジ" "ｼﾞ") ("ぇ" "ェ" "ｪ")))
    ((("j" "o"). ())(("じ" "ジ" "ｼﾞ") ("ょ" "ョ" "ｮ")))

    ((("j" "y" "a"). ())(("じ" "ジ" "ｼﾞ") ("ゃ" "ャ" "ｬ")))
    ((("j" "y" "i"). ())(("じ" "ジ" "ｼﾞ") ("ぃ" "ィ" "ｨ")))
    ((("j" "y" "u"). ())(("じ" "ジ" "ｼﾞ") ("ゅ" "ュ" "ｭ")))
    ((("j" "y" "e"). ())(("じ" "ジ" "ｼﾞ") ("ぇ" "ェ" "ｪ")))
    ((("j" "y" "o"). ())(("じ" "ジ" "ｼﾞ") ("ょ" "ョ" "ｮ")))

    ((("t" "t"). ("t"))("っ" "ッ" "ｯ"))
    ((("t" "c"). ("c"))("っ" "ッ" "ｯ"))

    ((("t" "a"). ())("た" "タ" "ﾀ"))
    ((("t" "i"). ())("ち" "チ" "ﾁ"))
    ((("t" "u"). ())("つ" "ツ" "ﾂ"))
    ((("t" "e"). ())("て" "テ" "ﾃ"))
    ((("t" "o"). ())("と" "ト" "ﾄ"))

    ((("t" "y" "a"). ())(("ち" "チ" "ﾁ") ("ゃ" "ャ" "ｬ")))
    ((("t" "y" "i"). ())(("ち" "チ" "ﾁ") ("ぃ" "ィ" "ｨ")))
    ((("t" "y" "u"). ())(("ち" "チ" "ﾁ") ("ゅ" "ュ" "ｭ")))
    ((("t" "y" "e"). ())(("ち" "チ" "ﾁ") ("ぇ" "ェ" "ｪ")))
    ((("t" "y" "o"). ())(("ち" "チ" "ﾁ") ("ょ" "ョ" "ｮ")))

    ((("t" "s" "a"). ())(("つ" "ツ" "ﾂ") ("ぁ" "ァ" "ｧ")))
    ((("t" "s" "i"). ())(("つ" "ツ" "ﾂ") ("ぃ" "ィ" "ｨ")))
    ((("t" "s" "u"). ())("つ" "ツ" "ﾂ"))
    ((("t" "s" "e"). ())(("つ" "ツ" "ﾂ") ("ぇ" "ェ" "ｪ")))
    ((("t" "s" "o"). ())(("つ" "ツ" "ﾂ") ("ぉ" "ォ" "ｫ")))

    ((("c" "y" "a"). ())(("ち" "チ" "ﾁ") ("ゃ" "ャ" "ｬ")))
    ((("c" "y" "i"). ())(("ち" "チ" "ﾁ") ("ぃ" "ィ" "ｨ")))
    ((("c" "y" "u"). ())(("ち" "チ" "ﾁ") ("ゅ" "ュ" "ｭ")))
    ((("c" "y" "e"). ())(("ち" "チ" "ﾁ") ("ぇ" "ェ" "ｪ")))
    ((("c" "y" "o"). ())(("ち" "チ" "ﾁ") ("ょ" "ョ" "ｮ")))

    ((("x" "t" "u"). ())("っ" "ッ" "ｯ"))
    ((("x" "t" "s" "u"). ())("っ" "ッ" "ｯ"))
    ((("c" "c"). ("c"))("っ" "ッ" "ｯ"))

    ((("d" "d"). ("d"))("っ" "ッ" "ｯ"))

    ((("d" "a"). ())("だ" "ダ" "ﾀﾞ"))
    ((("d" "i"). ())("ぢ" "ヂ" "ﾁﾞ"))
    ((("d" "u"). ())("づ" "ヅ" "ﾂﾞ"))
    ((("d" "e"). ())("で" "デ" "ﾃﾞ"))
    ((("d" "o"). ())("ど" "ド" "ﾄﾞ"))

    ((("d" "y" "a"). ())(("ぢ" "ヂ" "ﾁﾞ") ("ゃ" "ャ" "ｬ")))
    ((("d" "y" "i"). ())(("ぢ" "ヂ" "ﾁﾞ") ("ぃ" "ィ" "ｨ")))
    ((("d" "y" "u"). ())(("ぢ" "ヂ" "ﾁﾞ") ("ゅ" "ュ" "ｭ")))
    ((("d" "y" "e"). ())(("ぢ" "ヂ" "ﾁﾞ") ("ぇ" "ェ" "ｪ")))
    ((("d" "y" "o"). ())(("ぢ" "ヂ" "ﾁﾞ") ("ょ" "ョ" "ｮ")))

    ((("n" "n"). ())("ん" "ン" "ﾝ"))
    ((("n" "'"). ())("ん" "ン" "ﾝ"))
    ((("n"). ())("ん" "ン" "ﾝ"))

    ((("n" "a"). ())("な" "ナ" "ﾅ"))
    ((("n" "i"). ())("に" "ニ" "ﾆ"))
    ((("n" "u"). ())("ぬ" "ヌ" "ﾇ"))
    ((("n" "e"). ())("ね" "ネ" "ﾈ"))
    ((("n" "o"). ())("の" "ノ" "ﾉ"))

    ((("n" "y" "a"). ())(("に" "ニ" "ﾆ") ("ゃ" "ャ" "ｬ")))
    ((("n" "y" "i"). ())(("に" "ニ" "ﾆ") ("ぃ" "ィ" "ｨ")))
    ((("n" "y" "u"). ())(("に" "ニ" "ﾆ") ("ゅ" "ュ" "ｭ")))
    ((("n" "y" "e"). ())(("に" "ニ" "ﾆ") ("ぇ" "ェ" "ｪ")))
    ((("n" "y" "o"). ())(("に" "ニ" "ﾆ") ("ょ" "ョ" "ｮ")))

    ((("h" "h"). ("h"))("っ" "ッ" "ｯ"))

    ((("h" "a"). ())("は" "ハ" "ﾊ"))
    ((("h" "i"). ())("ひ" "ヒ" "ﾋ"))
    ((("h" "u"). ())("ふ" "フ" "ﾌ"))
    ((("h" "e"). ())("へ" "ヘ" "ﾍ"))
    ((("h" "o"). ())("ほ" "ホ" "ﾎ"))

    ((("h" "y" "a"). ())(("ひ" "ヒ" "ﾋ") ("ゃ" "ャ" "ｬ")))
    ((("h" "y" "i"). ())(("ひ" "ヒ" "ﾋ") ("ぃ" "ィ" "ｨ")))
    ((("h" "y" "u"). ())(("ひ" "ヒ" "ﾋ") ("ゅ" "ュ" "ｭ")))
    ((("h" "y" "e"). ())(("ひ" "ヒ" "ﾋ") ("ぇ" "ェ" "ｪ")))
    ((("h" "y" "o"). ())(("ひ" "ヒ" "ﾋ") ("ょ" "ョ" "ｮ")))

    ((("f" "f"). ("f"))("っ" "ッ" "ｯ"))

    ((("f" "a"). ())(("ふ" "フ" "ﾌ") ("ぁ" "ァ" "ｧ")))
    ((("f" "i"). ())(("ふ" "フ" "ﾌ") ("ぃ" "ィ" "ｨ")))
    ((("f" "u"). ())("ふ" "フ" "ﾌ"))
    ((("f" "e"). ())(("ふ" "フ" "ﾌ") ("ぇ" "ェ" "ｪ")))
    ((("f" "o"). ())(("ふ" "フ" "ﾌ") ("ぉ" "ォ" "ｫ")))

    ((("f" "y" "a"). ())(("ふ" "フ" "ﾌ") ("ゃ" "ャ" "ｬ")))
    ((("f" "y" "i"). ())(("ふ" "フ" "ﾌ") ("ぃ" "ィ" "ｨ")))
    ((("f" "y" "u"). ())(("ふ" "フ" "ﾌ") ("ゅ" "ュ" "ｭ")))
    ((("f" "y" "e"). ())(("ふ" "フ" "ﾌ") ("ぇ" "ェ" "ｪ")))
    ((("f" "y" "o"). ())(("ふ" "フ" "ﾌ") ("ょ" "ョ" "ｮ")))

    ((("b" "b"). ("b"))("っ" "ッ" "ｯ"))

    ((("b" "a"). ())("ば" "バ" "ﾊﾞ"))
    ((("b" "i"). ())("び" "ビ" "ﾋﾞ"))
    ((("b" "u"). ())("ぶ" "ブ" "ﾌﾞ"))
    ((("b" "e"). ())("べ" "ベ" "ﾍﾞ"))
    ((("b" "o"). ())("ぼ" "ボ" "ﾎﾞ"))

    ((("b" "y" "a"). ())(("び" "ビ" "ﾋﾞ") ("ゃ" "ャ" "ｬ")))
    ((("b" "y" "i"). ())(("び" "ビ" "ﾋﾞ") ("ぃ" "ィ" "ｨ")))
    ((("b" "y" "u"). ())(("び" "ビ" "ﾋﾞ") ("ゅ" "ュ" "ｭ")))
    ((("b" "y" "e"). ())(("び" "ビ" "ﾋﾞ") ("ぇ" "ェ" "ｪ")))
    ((("b" "y" "o"). ())(("び" "ビ" "ﾋﾞ") ("ょ" "ョ" "ｮ")))

    ((("p" "p"). ("p"))("っ" "ッ" "ｯ"))

    ((("p" "a"). ())("ぱ" "パ" "ﾊﾟ"))
    ((("p" "i"). ())("ぴ" "ピ" "ﾋﾟ"))
    ((("p" "u"). ())("ぷ" "プ" "ﾌﾟ"))
    ((("p" "e"). ())("ぺ" "ペ" "ﾍﾟ"))
    ((("p" "o"). ())("ぽ" "ポ" "ﾎﾟ"))

    ((("p" "y" "a"). ())(("ぴ" "ピ" "ﾋﾟ") ("ゃ" "ャ" "ｬ")))
    ((("p" "y" "i"). ())(("ぴ" "ピ" "ﾋﾟ") ("ぃ" "ィ" "ｨ")))
    ((("p" "y" "u"). ())(("ぴ" "ピ" "ﾋﾟ") ("ゅ" "ュ" "ｭ")))
    ((("p" "y" "e"). ())(("ぴ" "ピ" "ﾋﾟ") ("ぇ" "ェ" "ｪ")))
    ((("p" "y" "o"). ())(("ぴ" "ピ" "ﾋﾟ") ("ょ" "ョ" "ｮ")))

    ((("m" "m"). ("m"))("っ" "ッ" "ｯ"))

    ((("m" "b"). ("b"))("ん" "ン" "ﾝ"))
    ((("m" "p"). ("p"))("ん" "ン" "ﾝ"))

    ((("m" "a"). ())("ま" "マ" "ﾏ"))
    ((("m" "i"). ())("み" "ミ" "ﾐ"))
    ((("m" "u"). ())("む" "ム" "ﾑ"))
    ((("m" "e"). ())("め" "メ" "ﾒ"))
    ((("m" "o"). ())("も" "モ" "ﾓ"))

    ((("m" "y" "a"). ())(("み" "ミ" "ﾐ") ("ゃ" "ャ" "ｬ")))
    ((("m" "y" "i"). ())(("み" "ミ" "ﾐ") ("ぃ" "ィ" "ｨ")))
    ((("m" "y" "u"). ())(("み" "ミ" "ﾐ") ("ゅ" "ュ" "ｭ")))
    ((("m" "y" "e"). ())(("み" "ミ" "ﾐ") ("ぇ" "ェ" "ｪ")))
    ((("m" "y" "o"). ())(("み" "ミ" "ﾐ") ("ょ" "ョ" "ｮ")))

    ((("y" "y"). ("y"))("っ" "ッ" "ｯ"))

    ((("y" "a"). ())("や" "ヤ" "ﾔ"))
    ((("y" "u"). ())("ゆ" "ユ" "ﾕ"))
    ((("y" "e"). ())(("い" "イ" "ｲ") ("ぇ" "ェ" "ｪ")))
    ((("y" "o"). ())("よ" "ヨ" "ﾖ"))

    ((("x" "c" "a"). ())("ヵ" "ヵ" "ｶ"))
    ((("x" "k" "a"). ())("ヵ" "ヵ" "ｶ"))
    ((("x" "k" "e"). ())("ヶ" "ヶ" "ｹ"))

    ((("x" "y" "a"). ())("ゃ" "ャ" "ｬ"))
    ((("x" "y" "u"). ())("ゅ" "ュ" "ｭ"))
    ((("x" "y" "o"). ())("ょ" "ョ" "ｮ"))

    ((("r" "r"). ("r"))("っ" "ッ" "ｯ"))

    ((("r" "a"). ())("ら" "ラ" "ﾗ"))
    ((("r" "i"). ())("り" "リ" "ﾘ"))
    ((("r" "u"). ())("る" "ル" "ﾙ"))
    ((("r" "e"). ())("れ" "レ" "ﾚ"))
    ((("r" "o"). ())("ろ" "ロ" "ﾛ"))

    ((("l" "t" "u"). ())("っ" "ッ" "ｯ"))
    ((("l" "t" "s" "u"). ())("っ" "ッ" "ｯ"))

    ((("l" "y" "a"). ())("ゃ" "ャ" "ｬ"))
    ((("l" "y" "i"). ())("ぃ" "ィ" "ｨ"))
    ((("l" "y" "u"). ())("ゅ" "ュ" "ｭ"))
    ((("l" "y" "e"). ())("ぇ" "ェ" "ｪ"))
    ((("l" "y" "o"). ())("ょ" "ョ" "ｮ"))

    ((("r" "y" "a"). ())(("り" "リ" "ﾘ") ("ゃ" "ャ" "ｬ")))
    ((("r" "y" "i"). ())(("り" "リ" "ﾘ") ("ぃ" "ィ" "ｨ")))
    ((("r" "y" "u"). ())(("り" "リ" "ﾘ") ("ゅ" "ュ" "ｭ")))
    ((("r" "y" "e"). ())(("り" "リ" "ﾘ") ("ぇ" "ェ" "ｪ")))
    ((("r" "y" "o"). ())(("り" "リ" "ﾘ") ("ょ" "ョ" "ｮ")))

    ((("w" "w"). ("w"))("っ" "ッ" "ｯ"))

    ((("w" "a"). ())("わ" "ワ" "ﾜ"))
    ((("w" "i"). ())(("う" "ウ" "ｳ") ("ぃ" "ィ" "ｨ")))
    ((("w" "u"). ())("う" "ウ" "ｳ"))
    ((("w" "e"). ())(("う" "ウ" "ｳ") ("ぇ" "ェ" "ｪ")))
    ((("w" "o"). ())("を" "ヲ" "ｦ"))
    ((("w" "h" "a"). ())(("う" "ウ" "ｳ") ("ぁ" "ァ" "ｧ")))
    ((("w" "h" "i"). ())(("う" "ウ" "ｳ") ("ぃ" "ィ" "ｨ")))
    ((("w" "h" "u"). ())("う" "ウ" "ｳ"))
    ((("w" "h" "e"). ())(("う" "ウ" "ｳ") ("ぇ" "ェ" "ｪ")))
    ((("w" "h" "o"). ())(("う" "ウ" "ｳ") ("ぉ" "ォ" "ｫ")))

    ((("v" "v"). ("v"))("っ" "ッ" "ｯ"))

    ((("v" "a"). ())(("う゛" "ヴ" "ｳﾞ") ("ぁ" "ァ" "ｧ")))
    ((("v" "i"). ())(("う゛" "ヴ" "ｳﾞ") ("ぃ" "ィ" "ｨ")))
    ((("v" "u"). ())("う゛" "ヴ" "ｳﾞ"))
    ((("v" "e"). ())(("う゛" "ヴ" "ｳﾞ") ("ぇ" "ェ" "ｪ")))
    ((("v" "o"). ())(("う゛" "ヴ" "ｳﾞ") ("ぉ" "ォ" "ｫ")))

    ((("v" "y" "a"). ())(("う゛" "ヴ" "ｳﾞ") ("ゃ" "ャ" "ｬ")))
    ((("v" "y" "u"). ())(("う゛" "ヴ" "ｳﾞ") ("ゅ" "ュ" "ｭ")))
    ((("v" "y" "o"). ())(("う゛" "ヴ" "ｳﾞ") ("ょ" "ョ" "ｮ")))

    ((("z" "k"). ())("↑" "↑" ""))
    ((("z" "j"). ())("↓" "↓" ""))
    ((("z" "h"). ())("←" "←" ""))
    ((("z" "l"). ())("→" "→" ""))
    ((("z" "-"). ())("〜" "〜" ""))
    ((("z" "["). ())("『" "『" ""))
    ((("z" "]"). ())("』" "』" ""))
    ((("z" ","). ())("‥" "‥" ""))
    ((("z" "."). ())("…" "…" ""))
    ((("z" "/"). ())("・" "・" "･"))
    ))
(define ja-rk-rule (apply append (map (lambda (x) (if (list? (car x)) x (list x))) (map cadr ja-rk-rule-basic))))
